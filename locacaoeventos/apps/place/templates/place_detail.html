{% extends "_base_user.html" %}
{% block page_title %}{{place.name}}{% endblock page_title %}
{% block content %}

<!-- =====================================================
CSS imports
===================================================== -->  
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/CUSTOM_CSS/place/place_detail.css" type="text/css">
  <link rel="stylesheet" href="/static/CUSTOM_CSS/core/review.css" type="text/css">
  <link rel="stylesheet" href="/static/CUSTOM_CSS/core/custom_container.css" type="text/css">
  <link rel="stylesheet" href="/static/CUSTOM_CSS/user/home.css" type="text/css">




<!-- =====================================================
Body code
===================================================== -->
  <!-- DETAIL HEADER begin -->
  <div class="separador-20"> </div>
  <div class="detail_header_img center-cropped img-center" style="background-image: url(/media/{{photo_list_html.0}});">
  </div>
  <div class="separador-50"> </div>
  <!-- DETAIL HEADER end -->










  <!-- DETAIL DESCRIPTION begin -->
  <section class="container">
    <div class="row">
      <div class="col-md-3 col-md-push-9">
        <div id="buying_flux">
          <h1 class="detail_wrapper_title" style="text-align:left">Preços</h1>
          <h1>=========== A FAZER ===========</h1>
          {% for price in price_list %}
            {{price}}
          {% endfor %}
          <h1>=========== A FAZER ===========</h1>
        </div>
        <div class="separador-40"> </div>
      </div>






      <div class="col-md-9 col-md-pull-3">





        <h1 class="detail_wrapper_title">Sobre o Local</h1>
        <div class="detail_description_text justify_text">
          {{place.description}}
        </div>
        <div class="separador-40"> </div>
        <hr class="line"/>
        <div class="separador-40"> </div>
        <!-- Additional Information -->
        {% if additionalinformation|length > 0 %}
          <h1 class="detail_wrapper_title">Informações Adicionais</h1>
          <div class="separador-10"> </div>
          <div class="center_element">
            {% for info in additionalinformation %}
              {% if not forloop.first %}-->{% endif %}
              <div class="detail_description_card detail_additionalinformation">
                <img src="/static/img/123festas/logo.png"/>
                <div>{{info.name}}</div>
              </div>
              {% if not forloop.last %}&nbsp;&nbsp;<!--{% endif %}
            {% endfor %}<span style="display:none">--></span>
          </div>
          <div class="separador-40"> </div>
          <hr class="line"/>
          <div class="separador-40"> </div>
        {% endif %}
        {% if place.decoration or place.children_rides %}
          {% if place.decoration %}
            <h1 class="detail_wrapper_title">Decorações</h1>
            <div class="separador-10"> </div>
            <div>
              {% for decoration in place.decoration.0 %}
                {% if not forloop.first %}-->{% endif %}
                <div class="detail_description_card decoration_childrenrides">
                  <div>{{decoration}}</div>
                </div>
                {% if not forloop.last %}&nbsp;<!--{% endif %}
              {% endfor %}<span style="display:none">--></span>
            </div>
            <div class="separador-40"> </div>
            <hr class="line"/>
            <div class="separador-40"> </div>
          {% endif %}
          {% if place.children_rides %}
            <h1 class="detail_wrapper_title">Brinquedos</h1>
            <div class="separador-10"> </div>
            <div>
              {% for children_rides in place.children_rides.0 %}
                {% if not forloop.first %}-->{% endif %}
                <div class="detail_description_card decoration_childrenrides">
                  <div>{{children_rides}}</div>
                </div>
                {% if not forloop.last %}&nbsp;<!--{% endif %}
              {% endfor %}<span style="display:none">--></span>
            </div>
            <div class="separador-40"> </div>
            <hr class="line"/>
            <div class="separador-40"> </div>
          {% endif %}
        {% endif %}




        <!-- DETAIL MAP begin -->
        <div id="map" style="height:300px; width:100%"></div>
        <div class="separador-40"> </div>
        <hr class="line"/>
        <div class="separador-40"> </div>
        <!-- DETAIL MAP end -->



        <!-- DETAIL REVIEW begin -->
        {% if review_rates != "None" %}
          <h1 class="detail_wrapper_title" style="display:inline-block">({{review_rates.n_review}}) Avaliações &nbsp;&nbsp;</h1><!--
          --><span class="stars" style="color:#102766; font-size:20px" data-rating="{{review_rates.rate_average}}" data-num-stars="5"></span>
          <div class="row">
            <div class="col-md-6">
              <span class="rate_title">Infraestrutura &nbsp;&nbsp;</span><!--
              --><span class="stars review_stars" data-rating="{{review_rates.rate_infraestructure}}" data-num-stars="5"></span>
            </div>
            <div class="col-md-6">
              <span class="rate_title">Brinquedos &nbsp;&nbsp;</span><!--
              --><span class="stars review_stars" data-rating="{{review_rates.rate_rides}}" data-num-stars="5"></span>
            </div>
          </div>
          <div class="separador-10"> </div>
          <div class="row">
            <div class="col-md-6">
              <span class="rate_title">Custo Benefício &nbsp;&nbsp;</span><!--
              --><span class="stars review_stars" data-rating="{{review_rates.rate_cost_benefit}}" data-num-stars="5"></span>
            </div>
            <div class="col-md-6">
              <span class="rate_title">Atendimento &nbsp;&nbsp;</span><!--
              --><span class="stars review_stars" data-rating="{{review_rates.rate_attendance}}" data-num-stars="5"></span>
            </div>
          </div>
          <div class="separador-10"> </div>
          <div class="row">
            <div class="col-md-6">
              <span class="rate_title">Opinião das Crianças &nbsp;&nbsp;</span><!--
              --><span class="stars review_stars" data-rating="{{review_rates.rate_children_opinion}}" data-num-stars="5"></span>
            </div>
          </div>
          <div id="review_read_more">Leia Mais...</div>
          <div class="separador-40"> </div>
          <div id="reviews_wrapper">
            {% for review in review_list %}
              <div class="review_container">
                <div style="width:20%; display:inline-block; text-align:center; vertical-align:top">
                  <div class="center-cropped img-center buyerprofile_photo" style="background-image: url({% if review.buyerprofile.photo %}/media/{{review.buyerprofile.photo}}{% else %}/static/img/icon/user.png{% endif %});"></div>
                </div><!--


                --><div style="width:80%; display:inline-block; padding:10px 0 10px; color:#102766">
                  <span class="review_text_bold">{{review.buyerprofile.name}}</span>
                  <span style="color:#102766" class="stars" data-rating="{{review.rate}}" data-num-stars="5"></span>
                  <span class="review_text_bold see_more_reviews" pk="{{review.pk}}" style="font-weight:bold; font-size:16px">+</span><br>
                  {{review.creation}}
                  <div class="separador-10"> </div>
                  <span class="review_text_bold">Comentário</span><br>
                  {{review.comment}}
                  <div class="separador-10"> </div>



                  <div class="more_rating more_rating_{{review.pk}}">
                    <span style="color:#102766" class="stars" data-rating="{{review.rate_infraestructure}}" data-num-stars="5"></span> - Infraestrutura
                    <br>
                    <span style="color:#102766" class="stars" data-rating="{{review.rate_rides}}" data-num-stars="5"></span> - Brinquedos
                    <br>
                    <span style="color:#102766" class="stars" data-rating="{{review.rate_cost_benefit}}" data-num-stars="5"></span> - Custo-Benefício
                    <br>
                    <span style="color:#102766" class="stars" data-rating="{{review.rate_attendance}}" data-num-stars="5"></span> - Atendimento
                    <br>
                    <span style="color:#102766" class="stars" data-rating="{{review.rate_children_opinion}}" data-num-stars="5"></span> - Opinião das Crianças
                    <br>
                  </div>
                </div>
              </div>
              <div class="separador-10"> </div>
            {% endfor %}
          </div>
          <div class="separador-40"> </div>
          <hr class="line"/>
          <div class="separador-40"> </div>
        {% endif %}
        <!-- DETAIL REVIEW end -->








        <!-- DETAIL CALENDAR -->
        <h1 class="detail_wrapper_title">Disponibilidade do Local</h1>
        <div class="separador-30"> </div>
        <div style="width:100%; -webkit-box-align:center; -webkit-box-pack:center; display:-webkit-box;r">
          <div>{% include "calendar.html" %}</div>
        </div>
        <div class="separador-40"> </div>
        <hr class="line"/>
        <div class="separador-40"> </div>

        <!-- DETAIL VIDEO -->
        {% if place.video %}
          <h1 class="detail_wrapper_title">Vídeo do Local</h1>
          <div class="separador-30"> </div>
          <div class="center_element">
            <iframe src="{{place.video}}" id="place_video"></iframe>
          </div>
          <div class="separador-40"> </div>
          <hr class="line"/>
          <div class="separador-40"> </div>
        {% endif %}


        <!-- DETAIL MENU -->
        {% if place.menu %}
          <h1 class="detail_wrapper_title">Menu</h1>
          <div class="separador-30"> </div>
          <div class="center_element">
            <embed src="/media/{{place.menu}}" id="place_menu"/>
          </div>

          <div class="separador-40"> </div>
          <hr class="line"/>
          <div class="separador-40"> </div>            
        {% endif %}




      </div>
    </div>
  </section>
  <!-- DETAIL DESCRIPTION end -->


  <section id="featured" class="block equal-height">
    <div class="container">
      <header>
        <h2><span style="border-bottom:2px solid #94d600;">Buffets Semelhantes</span></h2>
      </header>
      <div class="row">
        {% for i in "xxxx" %}
          <div class="col-md-3 col-sm-3">
            <div class="item" style="margin-bottom:20px; cursor:pointer;">
              <div class="img-center center-cropped feature_image" style="background-image: url(/static/img/background/FESTAS1-2.jpg);"></div><!--
              --><div class="feature_wrapper">
                  <h3 style="margin:0">Benny’s Cafeteria</h3>
                  <span style="color:white" class="stars" data-rating="3.8" data-num-stars="5"></span>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <!--/.row-->
    </div>
    <!--/.container-->
    <div class="background opacity-5">
      <img src="/static/base_template_user/assets/img/restaurants-bg2.jpg" alt="">
    </div>
  </section>





















                  









  {% block jquery %}
      <script type="text/javascript" src="/static/base_template_user/assets/js/jquery-2.1.0.min.js"></script>
  {% endblock jquery %}



  <!-- CHAT begin -->
  {% if user_type == "buyer" %}
    <style>
      #chat_container {
        position:fixed; 
        bottom:0;
        right:0;
        border-right:none;
        z-index:999999999999999999999;
        border-radius:15px 15px 0 0;
        width:280px;

      }
      #chat_opener {
        border-radius:13px 13px 0 0;
        background-color:#50a7bc;
        padding:13px 10px;
        font-size:16px;
        color:white;
        cursor:pointer
      }
      #chat_conversation {
        background-color: white;
        padding:10px;
        max-height:400px;
        overflow-y:scroll;
        padding-bottom:45px;
        display:none;
      }
      .chat_message {
        padding:7px 0;
      }
      .chat_photo {
        width:35px; 
        display:inline-block;
        padding-top:2px;
      }
      .chat_text_container {
        width:205px;
        display:inline-block;
        vertical-align:top
      }
      .chat_author {
        color:#011a5d;
        font-weight:bold;
        font-size:13px;
      }
      #message_text {
        padding-left:5px;
        vertical-align:middle;
      }
      #message_send {
        width:20%;
        display:inline-block;
        background-color:#50a7bc;
        text-align:center;
        height:40px;
        vertical-align:top;
        cursor:pointer;
      }
    </style>
    <div id="chat_container">
      <div id="chat_opener"><i class="fa fa-comment"></i>&nbsp;&nbsp;Conversa</div>
      <div id="chat_conversation">

        <div id="chat_conversation_container">
        </div>

        <div style="width:100%; position:fixed; bottom:0; right:0; width:280px;">
          <input id="message_text" placeholder="Digite..." style="width:80%; display:inline-block; height:40px;"><!--
          --><div id="message_send">
            <div style="height:100%; vertical-align:middle; line-height:40px; color:white;">
              <i class="fa fa-chevron-right"></i>
            </div>
          </div>
        </div>




      </div>
    </div>





<script>
    // =========================================
    // CHAT
    // =========================================

    $(document).ready(function(){

      setInterval(function(){
        var objDiv = document.getElementById("chat_conversation")
        objDiv.scrollTop = objDiv.scrollHeight
      }, 800)

      $("#chat_opener").click(function(){
        $("#chat_conversation").slideToggle()
      })      
      var place_pk = {{place_pk}}


      // ==============================
      // Get Messages
      // ==============================
      setInterval(function(){
        $.ajax({
          url: "/usuario/chat/get-place-detail/",
          dataType: 'json',
          data: {
            "place_pk":place_pk,
          },
          success: function (data) {
            if(data.messages.length>0) {
              var div_str = ''
              for(i=0;i<data.messages.length;i++) {
                var message = data.messages[i]
                div_str += '<div class="chat_message">'
                div_str +=   '<div class="chat_photo">'
                div_str +=     '<div class="center-cropped img-center" style="background-image: url(' + message.photo + '); width:30px; height:30px; border-radius:50%"></div>'
                div_str +=   '</div>'
                div_str +=   '<div class="chat_text_container">'
                div_str +=     '<div class="chat_author">'
                div_str +=       message.from
                div_str +=     '</div>'
                div_str +=     '<div class="chat_text">'
                for(j=0;j<message.message_text.length;j++){
                  div_str += message.message_text[j] + "<br>"
                }
                div_str +=     '</div>'
                div_str +=   '</div>'
                div_str += '</div>'
              }
              $("#chat_conversation_container").html(div_str)              
            } else {
              $("#chat_conversation_container").html("Envie uma mensagem!<br><br>")              
            }

          }
        })
      }, 800);


      // ==============================
      // Send Messages
      // ==============================
      $("#message_send").click(function(){
        if($("#message_text").val()!=""){
          $.ajax({
            url: "/usuario/chat/contact/",
            dataType: 'json',
            data: {
              "place_pk":place_pk,
              "message_text":$("#message_text").val(),
            },
            success: function (data) {
              $("#message_text").val("")
            }
          })  
        }
      })

       $('#message_text').on('keypress', function (e) {
         if(e.which === 13){
          $.ajax({
            url: "/usuario/chat/contact/",
            dataType: 'json',
            data: {
              "place_pk":place_pk,
              "message_text":$("#message_text").val(),
            },
            success: function (data) {
              $("#message_text").val("")
            }
          })  
         }
       });



    })
</script>












  {% endif %}
  <!-- CHAT end -->















<!-- =====================================================
JavaScript imports
===================================================== -->
<script type="text/javascript" src="/static/CUSTOM_JS/place/place_detail.js"></script>
<script type="text/javascript" src="/static/CUSTOM_JS/core/review.js"></script>
{% block old_custom_js %}{% endblock old_custom_js %}


<!-- MAPS -->
<script>
  function initMap() {
    var lat = parseFloat("{{place.lat}}".replace(',','.'))
    var lng = parseFloat("{{place.lng}}".replace(',','.'))
    var place_name = "{{place.name}}"
    var place_address = "{{place.address}}"
    var myLatLng = {lat: lat, lng: lng};

    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 15,
      center: myLatLng
    });

    var contentString = '<div id="content">'+
        '<div id="siteNotice">'+
        '</div>'+
        '<h1 id="firstHeading" class="firstHeading">' + place_name + '</h1>'+
        '<div id="bodyContent">'+
        '<p>' + place_address + '</p>'+
        '</div>'+
        '</div>'

    var infowindow = new google.maps.InfoWindow({
      content: contentString
    })


    var marker = new google.maps.Marker({
      position: myLatLng,
      map: map,
      title: 'Hello World!'
    })


    marker.addListener('click', function() {
      infowindow.open(map, marker);
    });

  }














// ==========================================
// GALERY
// ==========================================

// Detail Image
$(document).on("mouseenter", ".detail_gallery", function(){
  $(".detail_header_img_round").fadeIn(300)
})
$(document).on("mouseleave", ".detail_gallery", function(){
  $(".detail_header_img_round").fadeOut(300)
})

$(document).on("click", ".detail_header_img_round", function() {
  var photo_links = []
  var photo_counter = 0
  var photo_index = 0
  var photo_move_type = $(this).attr("type")
  // Find indexes
  $(".detail_gallery_other").each(function(){
    photo_links.push($(this).attr("style"))
    if($(this).hasClass("detail_photo_active")){
      if (photo_move_type=="right") {
        photo_index = photo_counter + 1
      } else {
        photo_index = photo_counter - 1
      }
      $(this).removeClass("detail_photo_active")
    }
    photo_counter += 1
  })  
  // Fix index
  if(photo_index==-1) {
    photo_index = photo_counter-1
  } else if(photo_index==photo_counter) {
    photo_index = 0
  }
  // Fix image
  var photo_counter_other = 0
  $(".detail_gallery_other").each(function(){
    if(photo_counter_other==photo_index) {
      $(this).addClass("detail_photo_active")
    }
    photo_counter_other += 1
  })  
  console.log(photo_index)
  $(".detail_gallery").attr("style", photo_links[photo_index])
})

$(document).on("click", ".detail_gallery_other", function() {
  $(".detail_gallery_other").each(function(){
      $(this).removeClass("detail_photo_active")
  })  
  $(this).addClass("detail_photo_active")
  
  $(".detail_gallery").attr("style", $(this).attr("style"))
})



$(document).click(function(e) {
  var classname = String(e.target.className);
  var idname = String(e.target.id);
  if(classname.indexOf("detail_header_img ")>=0){
    $("#black_layer").fadeIn(800)
    $("#black_layer").append(
      '<div class="detail_gallery center-cropped img-center" style="background-image: url(/media/{{photo_list_html.0}});" counter="0">' +
        '<div class="detail_header_img_mov" style="left:0px; padding-left:10px;">' +
          '<span class="detail_header_img_round" type="left">&#8249;</span>' +
        '</div>' +
        '<div class="detail_header_img_mov" style="right:0px; padding-right:10px;">' +
          '<span class="detail_header_img_round" type="right">&#8250;</span>' +
        '</div>' +
      '</div>' 
    )
    var photo_list = {{photo_list_js|safe}}
    console.log(photo_list)
    for(i=0;i<photo_list.length;i++){
      if(i==0){
        $("#black_layer").append(
          '<div class="detail_gallery_other center-cropped img-center detail_photo_active" style="background-image: url(/media/' + photo_list[i] + ');">' +
          '</div>'
        ) 
      } else {
        $("#black_layer").append(
          '<div class="detail_gallery_other center-cropped img-center" style="background-image: url(/media/' + photo_list[i] + ');">' +
          '</div>'
        )         
      }

    }
  } else if(idname=="black_layer") {
    $("#black_layer").html("")
    $("#black_layer").fadeOut(800)

  }
});



</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCgsG2vhClFly8kadgTOHCX4wucOwgTiuw&callback=initMap"> </script>
{% block js_maps %}{% endblock js_maps %}
{% endblock content %}

